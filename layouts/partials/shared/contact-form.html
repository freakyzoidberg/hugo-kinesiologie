<form id="contact-form">
  <fieldset id="{{ .Title | lower }}-inputs">
    <legend>{{ .Params.Name }}</legend>
    <label for="full-name">Full Name</label>
    <input type="text" name="name" id="name" placeholder="Nom complet" required>
    <label for="email">Address Email</label>
    <input type="email" name="email" id="email" placeholder="votre@email.com" required>
    <label for="tel">Numéro de téléphone</label>
    <input type="text" name="tel" id="tel" placeholder="0301020304" required>
    <label for="text">Message</label>
    <textarea rows="6" name="text" id="text" placeholder="Description de votre demande de renseignements et rendez-vous" required></textarea>
  </fieldset>
  <input type="submit" value="{{ if .Params.submit_button_label }}{{ .Params.submit_button_label }}{{ end }}">
</form>

<script>
const form = document.querySelector('form')
var sending= false;

form.addEventListener('submit', event => {
  if (document.getElementById("name").value == "") {
    return;
  }
  event.preventDefault()
  if (sending == false) {
    sending = true;
    fetch("/.netlify/functions/send-email", {
    method: "POST",
    headers: {
      'Accept': 'application/json',
      'Content-Type': 'application/json'
    },
    body: JSON.stringify({
      name: document.getElementById("name").value,
      email: document.getElementById("email").value,
      tel: document.getElementById("tel").value,
      text: document.getElementById("text").value
    }),
  })
  .then((response) => {
    sending = false;
    if (response.ok) {
      return response.text();
    } else {
      throw new Error('Something went wrong');
    }
  })
  .then(() => {
    console.log("Form successfully submitted"); 
    alert('Message envoyé')
    document.getElementById('contact-form').reset();
    document.getElementById("name").reset();
    document.getElementById("email").reset();
    document.getElementById("tel").reset();
    document.getElementById("text").reset();
  })
  .catch((error) => alert(error));
  }

  return false;
})
</script>